(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}})();console.log("Super Fancy Market News (Vite + TS) loaded");const D="https://summarizev3.451jscholz.workers.dev/summarize",P="https://summarizev3.451jscholz.workers.dev/reddit-trending";if(typeof window<"u"){const{protocol:e,hostname:t}=window.location;if(e==="http:"&&t!=="localhost"&&!t.startsWith("127.")){const{host:o,pathname:s,search:r,hash:n}=window.location;window.location.replace(`https://${o}${s}${r}${n}`)}if(window.top&&window.top!==window.self)try{window.top.location.href=window.location.href}catch{}}if(typeof window<"u"&&window.location.protocol==="file:"){const e=document.getElementById("banner");e&&(e.style.display="block",e.textContent="Opened locally (for best experience, run via Vite dev server over http://localhost)")}const v=document.getElementById("keyFinnhub"),T=document.getElementById("btnSave"),k=document.getElementById("pillKey");function $(e,t){k&&(k.textContent=e,k.classList.remove("ok","err"),k.classList.add(t?"ok":"err"))}if(v){const e=localStorage.getItem("sns_finnhub_key")||"";v.value=e,$(e?"Saved":"Not saved",!!e)}T&&v&&T.addEventListener("click",()=>{const e=v.value.trim();localStorage.setItem("sns_finnhub_key",e),$(e?"Saved":"Not saved",!!e)});function w(e){const t=document.getElementById("status");t&&(t.textContent=e)}function L(e){const t=document.getElementById("count");t&&(t.textContent=e?`${e} article${e===1?"":"s"}`:"")}function M(e){return/^[A-Z.\-]{1,7}$/.test(String(e||"").trim())}function R(e){if(!e)return"";const t=new Date(e);return Number.isNaN(t.getTime())?"":t.toLocaleString()}function O(e,t=""){const o=document.getElementById("log");if(!o)return;const s=document.createElement("div");t&&(s.className=t),s.textContent=e,o.appendChild(s)}function F(){const e=document.getElementById("log");e&&(e.innerHTML="")}function j(e){const t=document.createElement("textarea");return t.innerHTML=(e??"").toString(),t.value}function I(e){if(!e)return"";let t=String(e).trim();t=t.replace(/^```(?:json)?\s*/i,"").replace(/```$/,"").trim();try{const o=JSON.parse(t);o&&typeof o=="object"&&(o.summary||o.Summary)&&(t=String(o.summary||o.Summary||""))}catch{}return t=t.replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1").trim(),j(t)}function x(e){let t=I(e);return t=t.replace(/^\s*[-â€¢]\s*/,"").trim(),t}function U(e){if(!e)return[];if(Array.isArray(e))return e.map(x).filter(Boolean);if(typeof e=="string")return I(e).split(/\r?\n+/).map(t=>t.replace(/^\s*[-â€¢]\s*/,"").trim()).filter(Boolean);if(typeof e=="object"){const t=e;if(Array.isArray(t.bullets))return t.bullets.map(x).filter(Boolean);const o=Object.values(t).filter(s=>typeof s=="string");if(o.length)return o.map(x).filter(Boolean)}return[]}function z(e,t){if(t==="off")return e;const o=[],s=new Set;for(const r of e){let n;if(t==="url"&&r.url)try{const i=new URL(r.url);n=`${i.origin}${i.pathname}`}catch{n=r.url}else n=`${r.title}|${r.source}`;s.has(n)||(s.add(n),o.push(r))}return o}function H(e){const t=document.getElementById("results");if(!t)return;if(t.innerHTML="",!e.length){const n=document.createElement("div");n.className="item",n.textContent="No articles found.",t.appendChild(n),L(0);return}const o=document.getElementById("sort"),s=[...e];(o?.value||"relevance")==="time"&&s.sort((n,i)=>new Date(i.publishedAt).getTime()-new Date(n.publishedAt).getTime());for(const n of s){const i=document.createElement("div");i.className="item";const d=document.createElement("div"),c=document.createElement("span");c.className="pill",c.textContent=R(n.publishedAt);const a=document.createElement("span");a.className="pill",a.textContent=n.source||"News",d.appendChild(c),d.appendChild(a);const m=document.createElement("div"),l=document.createElement("a");if(l.href=n.url||"#",l.target="_blank",l.rel="noopener noreferrer",l.textContent=n.title||"(no title)",m.appendChild(l),i.appendChild(d),i.appendChild(m),n.description){const h=document.createElement("div");h.style.color="#94a3b8",h.style.marginTop="6px",h.textContent=n.description,i.appendChild(h)}const p=document.createElement("div");p.className="summary-box";const u=document.createElement("button");u.className="ghost",u.style.marginTop="8px",u.textContent="Summarize",u.addEventListener("click",()=>{_(n,p,u)});const f=document.createElement("div");f.appendChild(u),i.appendChild(f),i.appendChild(p),t.appendChild(i)}L(e.length)}async function _(e,t,o){try{o.disabled=!0,o.textContent="Summarizingâ€¦",t.innerHTML="";const s={url:e.url,title:e.title,source:e.source||"News",publishedAt:e.publishedAt||"",max_words:120,mode:"auto"},r=await fetch(D,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),mode:"cors"});if(!r.ok)throw new Error(`Summarizer HTTP ${r.status}`);const n=await r.json();if(n.error)throw new Error(n.error);const i=I(n.summary??n.Summary??""),d=U(n.bullets??n.Bullets);t.className="summary-box";const c=document.createElement("span");c.className="pill",c.textContent=n.from==="full"?"From article":"From headline";const a=document.createElement("div");a.className="summary-title",a.textContent="Summary";const m=document.createElement("div");if(m.className="summary-text",m.textContent=i||"(no summary)",t.appendChild(c),t.appendChild(a),t.appendChild(m),d.length){const l=document.createElement("div");l.className="summary-title",l.textContent="Key Points";const p=document.createElement("ul");p.className="summary-list",d.forEach(u=>{const f=document.createElement("li");f.textContent=u,p.appendChild(f)}),t.appendChild(l),t.appendChild(p)}}catch(s){t.className="summary-box",t.textContent=`Summary failed: ${s?.message||String(s)}`}finally{o.disabled=!1,o.textContent="Summarize"}}function V(e){const t=new Date;return{from:new Date(Date.now()-e*24*60*60*1e3).toISOString().slice(0,10),to:t.toISOString().slice(0,10)}}async function K(e,t,o,s){if(!M(e))throw new Error("Ticker required, e.g., NVDA");const{from:r,to:n}=V(o),i=new URL("https://finnhub.io/api/v1/company-news");i.searchParams.set("symbol",e.trim().toUpperCase()),i.searchParams.set("from",r),i.searchParams.set("to",n),i.searchParams.set("token",t);const d=await fetch(i.toString());if(!d.ok)throw new Error(`Finnhub HTTP ${d.status}`);const c=await d.json();return(Array.isArray(c)?c:[]).map(m=>({title:m.headline||"(no title)",url:m.url||"#",source:m.source||"News",description:m.summary||"",publishedAt:m.datetime?new Date(m.datetime*1e3).toISOString():new Date().toISOString()})).slice(0,s)}const g=document.getElementById("btnStart"),b=document.getElementById("btnCancel"),S=document.getElementById("ticker");async function B(){F();const e=(v?.value||"").trim(),t=(S?.value||"").trim(),o=document.getElementById("daysBack"),s=document.getElementById("maxResults"),r=document.getElementById("dedupe"),n=parseInt(o?.value||"7",10),i=parseInt(s?.value||"100",10),d=r?.value||"url";if(!e){w("Paste your Finnhub key and click Save.");return}if(!t){w("Type a ticker, e.g., NVDA.");return}w("Fetching company newsâ€¦"),g&&(g.disabled=!0),b&&(b.disabled=!0);try{const c=await K(t,e,n,i),a=z(c,d);H(a),w(a.length?"":"No results.")}catch(c){const a=c?.message||String(c);w(a),O(`Finnhub: ${a}`,"errtxt")}finally{g&&(g.disabled=!1),b&&(b.disabled=!0)}}g&&g.addEventListener("click",()=>{B()});S&&S.addEventListener("keydown",e=>{e.key==="Enter"&&B()});function N(e){const t=document.getElementById("trendList");if(!t)return;if(t.innerHTML="",!e.length){t.textContent="No trending tickers found.";return}const o=document.createElement("div");o.className="trend-grid trend-header";const s=document.createElement("div");s.textContent="#";const r=document.createElement("div");r.textContent="Ticker";const n=document.createElement("div");n.textContent="Name";const i=document.createElement("div");i.textContent="Mentions";const d=document.createElement("div");d.textContent="Upvotes";const c=document.createElement("div");c.textContent="Action",o.append(s,r,n,i,d,c),t.appendChild(o),e.forEach(a=>{const m=document.createElement("div");m.className="trend-row";const l=document.createElement("div");l.textContent=String(a.rank??"");const p=document.createElement("div");p.textContent=a.ticker??"";const u=document.createElement("div");u.textContent=a.name??"";const f=document.createElement("div");f.textContent=String(a.mentions??"");const h=document.createElement("div");h.textContent=String(a.upvotes??"");const y=document.createElement("div");y.className="trend-actions";const E=document.createElement("button");E.className="ghost",E.textContent="Open News",E.addEventListener("click",()=>{S&&(S.value=(a.ticker||"").toUpperCase(),B())}),y.appendChild(E),m.append(l,p,u,f,h,y),t.appendChild(m)})}async function Z(){const e=document.getElementById("trendFilter"),t=document.getElementById("trendLimit"),o=document.getElementById("trendStatus"),s=document.getElementById("trendSourceLabel"),r=document.getElementById("spinTrend"),n=document.getElementById("trendList"),i=e?.value||"all-stocks",d=parseInt(t?.value||"25",10)||25;r&&(r.style.display="inline-block"),o&&(o.textContent="Loading Reddit trendingâ€¦"),n&&(n.innerHTML="");let c="Unknown";try{try{const l=new URLSearchParams({filter:i,limit:String(d)}),p=`${P}?${l.toString()}`,u=await fetch(p,{method:"GET",mode:"cors"});if(u.ok){const f=await u.json();c=f.note?"ðŸ“Š Demo Data (Worker API failed)":"âœ… Reddit",o&&(o.textContent=`${f.count} trending tickers â€¢ ${new Date(f.asOf).toLocaleString()}`),s&&(s.textContent=c),N(f.results||[]);return}}catch(l){console.log("Worker failed:",l?.message||l)}const a=(v?.value||"").trim();if(a)try{const l=await fetch(`https://finnhub.io/api/v1/news?category=general&limit=${d}&token=${a}`);if(l.ok){const p=await l.json(),u={};(p||[]).forEach(h=>{(String(h.headline||"").match(/\b[A-Z]{1,5}\b/g)||[]).forEach(C=>{u[C]||(u[C]={rank:0,ticker:C,name:C,mentions:0,upvotes:0}),u[C].mentions+=1})});const f=Object.values(u).sort((h,y)=>y.mentions-h.mentions).slice(0,d).map((h,y)=>({...h,rank:y+1}));if(f.length){c="âœ… Real Data (Finnhub API)",o&&(o.textContent=`${f.length} trending tickers â€¢ ${new Date().toLocaleString()}`),s&&(s.textContent=c),N(f);return}}}catch(l){console.log("Finnhub trending failed:",l?.message||l)}const m=[{rank:1,ticker:"NVDA",name:"NVIDIA Corp",mentions:1247,upvotes:3421},{rank:2,ticker:"TSLA",name:"Tesla Inc",mentions:1089,upvotes:2983},{rank:3,ticker:"MSFT",name:"Microsoft Corp",mentions:956,upvotes:2654},{rank:4,ticker:"AAPL",name:"Apple Inc",mentions:847,upvotes:2341},{rank:5,ticker:"AMZN",name:"Amazon.com Inc",mentions:743,upvotes:2015}].slice(0,d);c="ðŸ“Š Demo Data (No API available)",o&&(o.textContent=`${m.length} trending tickers â€¢ ${new Date().toLocaleString()}`),s&&(s.textContent=c),N(m)}catch(a){c="ðŸ“Š Demo Data (Error occurred)",o&&(o.textContent=`Trending failed: ${a?.message||String(a)}`),s&&(s.textContent=c)}finally{r&&(r.style.display="none")}}const A=document.getElementById("btnTrending");A&&A.addEventListener("click",()=>{Z()});
//# sourceMappingURL=index-tWAaxT9T.js.map
